<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Restaurant System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container mt-5">
    <h2>Admin Dashboard</h2>
    <a href="{{ url_for('index') }}" class="btn btn-secondary mb-3">Back to Menu</a>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card p-3 mb-3">
                <h5>Total Orders</h5>
                <p>{{ total_orders }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 mb-3">
                <h5>Total Sales</h5>
                <p>${{ "%.2f"|format(total_sales) }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 mb-3">
                <h5>Items Sold</h5>
                <ul>
                    {% for item, count in item_counts.items() %}
                    <li>{{ item }}: {{ count }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card p-3 mb-3">
                <h5>Sales Trend</h5>
                <canvas id="salesTrend"></canvas>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-3 mb-3">
                <h5>Item Popularity</h5>
                <canvas id="itemPopularity"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    // Sales Trend Chart
    const salesCtx = document.getElementById('salesTrend').getContext('2d');
    const salesTrend = new Chart(salesCtx, {
        type: 'line',
        data: {
            labels: {{ sales_dates|safe }},  // e.g. ['2025-08-01', '2025-08-02']
            datasets: [{
                label: 'Total Sales ($)',
                data: {{ sales_amounts|safe }},
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true }
            }
        }
    });

    // Item Popularity Chart
    const itemCtx = document.getElementById('itemPopularity').getContext('2d');
    const itemPopularity = new Chart(itemCtx, {
        type: 'bar',
        data: {
            labels: {{ item_names|safe }},  // e.g. ['Burger', 'Pizza', 'Pasta']
            datasets: [{
                label: 'Quantity Sold',
                data: {{ item_counts_list|safe }},
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
</body>
</html>-->




<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('index') }}">Restaurant</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        {% if current_user.is_authenticated %}
          {% if current_user.is_admin %}
            <li class="nav-item"><a class="nav-link active" href="{{ url_for('dashboard') }}">Dashboard</a></li>
          {% else %}
            <li class="nav-item"><a class="nav-link" href="{{ url_for('my_orders') }}">My Orders</a></li>
          {% endif %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('login') }}">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('register') }}">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<div class="container py-4">

  <!-- KPI Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-1">Total Sales</h6>
          <h3>${{ total_sales }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-1">Total Orders</h6>
          <h3>{{ total_orders }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-1">Avg Order Value</h6>
          <h3>${{ aov }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-1">Repeat Customer Rate</h6>
          <h3>{{ repeat_rate }}%</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Sales Trend (Daily)</div>
        <div class="card-body">
          <canvas id="salesDaily"></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Sales Trend (Weekly)</div>
        <div class="card-body">
          <canvas id="salesWeekly"></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Top 10 Items (Quantity)</div>
        <div class="card-body">
          <canvas id="topItems"></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Top 10 Customers (Revenue)</div>
        <div class="card-body">
          <canvas id="topCustomers"></canvas>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Orders by Weekday</div>
        <div class="card-body">
          <canvas id="weekdayChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Data from Flask/Jinja
  const salesDates = {{ sales_dates|tojson }};
  const salesAmounts = {{ sales_amounts|tojson }};
  const weekLabels = {{ week_labels|tojson }};
  const weekAmounts = {{ week_amounts|tojson }};
  const itemNames = {{ item_names|tojson }};
  const itemQtys = {{ item_qtys|tojson }};
  const customerNames = {{ customer_names|tojson }};
  const customerRevenue = {{ customer_revenue|tojson }};
  const weekdayLabels = {{ weekday_labels|tojson }};
  const weekdayValues = {{ weekday_values|tojson }};

  const moneyFmt = (v) => '$' + Number(v).toLocaleString();

  // Daily Sales (Line)
  new Chart(document.getElementById('salesDaily').getContext('2d'), {
    type: 'line',
    data: {
      labels: salesDates,
      datasets: [{ label: 'Daily Sales', data: salesAmounts, tension: 0.3 }]
    },
    options: {
      responsive: true,
      plugins: { tooltip: { callbacks: { label: ctx => moneyFmt(ctx.parsed.y) } } },
      scales: { y: { ticks: { callback: v => '$' + v } } }
    }
  });

  // Weekly Sales (Bar)
  new Chart(document.getElementById('salesWeekly').getContext('2d'), {
    type: 'bar',
    data: {
      labels: weekLabels,
      datasets: [{ label: 'Weekly Sales', data: weekAmounts }]
    },
    options: {
      responsive: true,
      plugins: { tooltip: { callbacks: { label: ctx => moneyFmt(ctx.parsed.y) } } },
      scales: { y: { ticks: { callback: v => '$' + v } } }
    }
  });

  // Top Items (Bar)
  new Chart(document.getElementById('topItems').getContext('2d'), {
    type: 'bar',
    data: {
      labels: itemNames,
      datasets: [{ label: 'Quantity Sold', data: itemQtys }]
    },
    options: {
      responsive: true,
      indexAxis: 'y',
      plugins: { legend: { display: false } }
    }
  });

  // Top Customers (Bar)
  new Chart(document.getElementById('topCustomers').getContext('2d'), {
    type: 'bar',
    data: {
      labels: customerNames,
      datasets: [{ label: 'Revenue', data: customerRevenue }]
    },
    options: {
      responsive: true,
      indexAxis: 'y',
      plugins: { tooltip: { callbacks: { label: ctx => moneyFmt(ctx.parsed.x) } }, legend: { display: false } },
      scales: { x: { ticks: { callback: v => '$' + v } } }
    }
  });

  // Weekday Orders (Bar, heatmap-like)
  new Chart(document.getElementById('weekdayChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: weekdayLabels,
      datasets: [{ label: 'Orders', data: weekdayValues }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } }
    }
  });
</script>
</body>
</html>

